---
- hosts: consul_server
  become_user: root
  become: yes
  roles:
  - consul-binary
  - generate-ssl-certifcates
  - consul-service
  - consul-kv-config
  vars:
    - server: yes
    - bind_ip: 192.168.42.10
    - ssl_gen_dir: "/vagrant/ssl-certs/"
    - datacaenter: "vagrant"

- hosts: mongodb
  become_user: root
  become: yes
  roles:
  - consul-binary
  - consul-service
  - mongodb-server
  vars:
    - consul_server: 192.168.42.10
    - bind_ip: 192.168.42.11

- hosts: rabbitmq
  become_user: root
  become: yes
  roles:
  - consul-binary
  - consul-service
#  - rabbitmq-server
  - rabbitmq-server-ssl-enable

  vars:
    - consul_server: 192.168.42.10
    - bind_ip: 192.168.42.12
    - ca_cert_source: "/vagrant/ssl-certs/consul-agent-ca.pem"
    - server_cert_source: "/vagrant/ssl-certs/vagrant-server-consul-0.pem"
    - server_key_source: "/vagrant/ssl-certs/vagrant-server-consul-0-key.pem"
    - client_cert_source: "/vagrant/ssl-certs/vagrant-client-consul-0.pem"
    - client_key_source: "/vagrant/ssl-certs/vagrant-client-consul-0-key.pem"
    - remote_source: yes
