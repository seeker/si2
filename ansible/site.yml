---
- hosts: consul_server
  become_user: root
  become: yes
  roles:
  - consul-binary
  - consul-service
  - consul-kv-config
  vars:
    - server: yes
    - bind_ip: 192.168.42.10
    - consul_client_ip: "{{ bind_ip }}"

- hosts: mongodb
  become_user: root
  become: yes
  roles:
  - consul-binary
  - consul-service
  - mongodb-server
  vars:
    - consul_server: 192.168.42.10
    - bind_ip: 192.168.42.11

- hosts: rabbitmq
  become_user: root
  become: yes
  roles:
  - consul-binary
  - consul-service
  - rabbitmq-server
  vars:
    - consul_server: 192.168.42.10
    - bind_ip: 192.168.42.12

- hosts: vault
  become_user: root
  become: yes
  pre_tasks:
  - set_fact:
      vault_token: "{{ lookup('file', '../vault-root-token') }}"
      cacheable: yes
    
  roles:
  - vault-binary
  - consul-binary
  - consul-service
  - vault-service
  - dev-vault-init
  - vault-approle-auth
  - vault-pki
  vars:
    - consul_server: 192.168.42.10
    - bind_ip: 192.168.42.13
